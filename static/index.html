<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>모동숲 다이어리</title>
    <link rel="stylesheet" href="/static/styles.css?v=20260218iosfab3" />
  </head>
  <body>
    <main class="container">
      <header class="site-header">
        <button id="brandHomeBtn" type="button" class="brand-home-btn">모동숲 다이어리</button>
        <nav class="top-nav" id="topNav" aria-label="주요 메뉴" role="navigation"></nav>
      </header>
      <p id="navBreadcrumb" class="nav-breadcrumb hidden" aria-live="polite"></p>

      <section id="homePanel" class="hidden">
        <section class="control-group">
          <div class="home-island-header">
            <h2>내 섬</h2>
            <button id="openSettingsModalBtn" type="button" aria-haspopup="dialog" aria-controls="settingsModal">
              정보 수정
            </button>
          </div>
          <p id="homeIslandNameText" class="profile-status">섬 이름: -</p>
          <p id="homeMainPlayerText" class="profile-status">주민대표: -</p>
          <p id="homeMainPlayerBirthdayText" class="profile-status">주민대표 생일: -</p>
        </section>

        <section class="control-group">
          <div class="home-island-header">
            <h2>현재 섬 주민</h2>
            <p id="homeIslandResidentCountText" class="profile-status">0/10</p>
          </div>
          <p id="homeResidentStatus" class="profile-status" aria-live="polite"></p>
          <div id="homeIslandResidents" class="home-resident-grid"></div>
        </section>

        <section
          id="homeResidentPickerModal"
          class="modal hidden"
          role="dialog"
          aria-modal="true"
          aria-hidden="true"
          aria-labelledby="homeResidentPickerTitle"
        >
          <div id="homeResidentPickerBackdrop" class="modal-backdrop"></div>
          <article class="modal-panel">
            <header class="modal-header">
              <h2 id="homeResidentPickerTitle">섬 주민 등록</h2>
              <button id="homeResidentPickerCloseBtn" type="button" class="modal-close">닫기</button>
            </header>
            <div class="modal-body">
              <div class="controls home-resident-picker-controls">
                <input id="homeResidentSearchInput" type="text" placeholder="주민 이름 검색 (한글/영문)" />
                <select id="homeResidentPersonalitySelect">
                  <option value="">성격 전체</option>
                </select>
                <select id="homeResidentSpeciesSelect">
                  <option value="">종 전체</option>
                </select>
              </div>
              <p id="homeResidentPickerStatus" class="profile-status"></p>
              <div id="homeResidentPickerList" class="home-resident-picker-grid"></div>
            </div>
          </article>
        </section>

        <section class="control-group home-calendar">
          <div class="home-island-header">
            <h2>NPC 방문 캘린더</h2>
            <button id="openEventsFromHomeBtn" type="button" aria-label="이벤트 카테고리 열기">이벤트 보기</button>
          </div>
          <div class="controls home-calendar-time-controls">
            <label class="inline-check"
              ><input id="timeTravelEnabledInput" type="checkbox" /> 타임슬립 시간 사용</label
            >
            <input id="gameDateTimeInput" type="datetime-local" />
            <button id="setNowGameTimeBtn" type="button">현재 시간으로</button>
          </div>
          <p id="effectiveDateTimeText" class="profile-status"></p>
          <div class="calendar-toolbar">
            <button id="calendarPrevBtn" type="button">이전달</button>
            <strong id="calendarMonthLabel"></strong>
            <button id="calendarNextBtn" type="button">다음달</button>
          </div>
          <div class="calendar-weekdays">
            <span>일</span>
            <span>월</span>
            <span>화</span>
            <span>수</span>
            <span>목</span>
            <span>금</span>
            <span>토</span>
          </div>
          <div id="calendarGrid" class="calendar-grid"></div>
          <div class="calendar-entry-form">
            <input id="calendarSelectedDate" type="date" />
            <input id="calendarNoteInput" type="text" placeholder="메모" />
            <label><input id="calendarCheckedInput" type="checkbox" /> 방문 확인</label>
          </div>
          <div class="calendar-npc-picker">
            <p class="profile-status">해당 날짜에 방문한 NPC를 클릭해서 추가</p>
            <div id="npcPicker" class="npc-picker"></div>
          </div>
          <ul id="calendarEntryList" class="calendar-entry-list"></ul>
        </section>

        <section class="control-group home-summary">
          <h2>오늘의 요약</h2>
          <div class="summary-cards">
            <article class="summary-card">
              <h3>현재 시즌</h3>
              <p id="summarySeasonText">-</p>
            </article>
            <article class="summary-card">
              <h3>별자리</h3>
              <p id="summaryZodiacText">-</p>
            </article>
            <article class="summary-card">
              <h3>시즌 레시피</h3>
              <p id="summarySeasonalRecipesText">-</p>
            </article>
            <article class="summary-card">
              <h3>개화 중 낮은 나무</h3>
              <p id="summaryBloomingShrubsText">-</p>
            </article>
          </div>
          <h3 class="summary-subtitle">다가오는 이벤트</h3>
          <ul id="summaryUpcomingEvents" class="calendar-entry-list"></ul>

          <h3 class="summary-subtitle">오늘의 너굴 쇼핑</h3>
          <ul id="summaryNookShopping" class="calendar-entry-list"></ul>

          <h3 class="summary-subtitle">이번 시즌 레시피</h3>
          <ul id="summarySeasonalRecipes" class="calendar-entry-list"></ul>

          <h3 class="summary-subtitle">개화 중인 낮은 나무</h3>
          <ul id="summaryBloomingShrubs" class="calendar-entry-list"></ul>

          <h3 class="summary-subtitle">카탈로그 진행률</h3>
          <div id="summaryCatalogProgress" class="progress-grid"></div>
        </section>
      </section>

      <section
        id="settingsModal"
        class="modal hidden"
        role="dialog"
        aria-modal="true"
        aria-hidden="true"
        aria-labelledby="settingsModalTitle"
      >
        <div id="settingsModalBackdrop" class="modal-backdrop"></div>
        <article class="modal-panel">
          <header class="modal-header">
            <h2 id="settingsModalTitle">섬/플레이어 정보 설정</h2>
            <div class="modal-header-actions">
              <button id="saveProfileBtn" type="button">저장</button>
              <button id="settingsModalCloseBtn" type="button" class="modal-close">닫기</button>
            </div>
          </header>
          <div class="modal-body">
            <section class="control-group">
              <h2>섬 정보</h2>
              <div class="island-settings-grid">
                <input id="islandNameInput" type="text" placeholder="섬 이름" />
                <select id="hemisphereSelect">
                  <option value="north">북반구</option>
                  <option value="south">남반구</option>
                </select>
                <select id="representativeFruitInput">
                  <option value="">대표 과일 선택</option>
                  <option value="apple">사과</option>
                  <option value="cherry">체리</option>
                  <option value="orange">오렌지</option>
                  <option value="peach">복숭아</option>
                  <option value="pear">배</option>
                </select>
                <select id="representativeFlowerInput">
                  <option value="">대표 꽃 선택</option>
                  <option value="cosmos">코스모스</option>
                  <option value="hyacinth">히아신스</option>
                  <option value="lily">백합</option>
                  <option value="mum">국화</option>
                  <option value="pansy">팬지</option>
                  <option value="rose">장미</option>
                  <option value="tulip">튤립</option>
                  <option value="windflower">아네모네</option>
                </select>
                <div class="rep-section">
                  <h2>주민 대표</h2>
                  <div class="rep-fields-row">
                    <input id="nicknameInput" type="text" placeholder="주민대표 이름" />
                    <div class="month-day-selects">
                      <select id="birthdayMonthInput" aria-label="주민대표 생일 월">
                        <option value="">월</option>
                      </select>
                      <select id="birthdayDayInput" aria-label="주민대표 생일 일">
                        <option value="">일</option>
                      </select>
                    </div>
                    <button id="addSubPlayerBtn" type="button">부주 추가</button>
                  </div>
                </div>
              </div>
              <p id="profileStatus" class="profile-status" aria-live="polite"></p>
              <div id="subPlayerForm" class="controls home-player-controls hidden">
                <input id="playerNameInput" type="text" placeholder="플레이어 이름" />
                <div class="month-day-selects">
                  <select id="playerBirthdayMonthInput" aria-label="플레이어 생일 월">
                    <option value="">월</option>
                  </select>
                  <select id="playerBirthdayDayInput" aria-label="플레이어 생일 일">
                    <option value="">일</option>
                  </select>
                </div>
                <button id="savePlayerBtn" type="button">플레이어 등록</button>
                <button id="clearPlayerFormBtn" type="button">입력 초기화</button>
                <button id="cancelSubPlayerBtn" type="button">닫기</button>
              </div>
              <p id="playerStatus" class="profile-status" aria-live="polite"></p>
              <ul id="playerList" class="calendar-entry-list"></ul>
            </section>
          </div>
        </article>
      </section>

      <section id="villagerPanel">
        <section class="control-groups">
          <div class="control-group">
            <h2>필터/정렬</h2>
            <div class="controls controls-inline">
              <input id="searchInput" type="text" placeholder="주민 이름 검색 (한글/영문)" />
              <select id="personalitySelect">
                <option value="">성격 전체</option>
              </select>
              <select id="speciesSelect">
                <option value="">종 전체</option>
              </select>
              <select id="sortBySelect">
                <option value="name">이름순</option>
                <option value="species">종순</option>
                <option value="birthday">생일순</option>
                <option value="personality">성격순</option>
              </select>
              <select id="sortOrderSelect">
                <option value="asc">오름차순</option>
                <option value="desc">내림차순</option>
              </select>
              <button id="resetBtn" type="button">초기화</button>
            </div>
          </div>
        </section>

        <section class="tabs" id="villagerTabs">
          <button type="button" class="tab active" data-tab="all">전체 주민</button>
          <button type="button" class="tab" data-tab="liked">좋아하는 주민</button>
          <button type="button" class="tab" data-tab="island">우리 섬 주민</button>
          <button type="button" class="tab" data-tab="former">과거 주민</button>
        </section>
      </section>

      <section id="catalogPanel" class="hidden">
        <section class="control-groups">
          <div class="control-group">
            <h2>필터/정렬</h2>
            <div class="controls controls-inline">
              <input id="catalogSearchInput" type="text" placeholder="이름 검색" />
              <select id="catalogExtraSelect" class="hidden"></select>
              <button id="catalogArtGuideBtn" type="button" class="hidden">진품/가품 특징</button>
              <select id="catalogSortBySelect">
                <option value="name">이름순</option>
                <option value="number">번호순</option>
                <option value="category">분류순</option>
                <option value="date">날짜순</option>
              </select>
              <select id="catalogSortOrderSelect">
                <option value="asc">오름차순</option>
                <option value="desc">내림차순</option>
              </select>
              <button
                id="catalogToggleAllBtn"
                type="button"
                onclick="return window.__acnhToggleAllOwnedInline(event);"
              >
                전체
              </button>
              <button id="catalogResetBtn" type="button">초기화</button>
            </div>
          </div>
        </section>

        <section class="tabs" id="catalogTabs">
          <button type="button" class="tab active" data-tab="all">전체</button>
          <span id="subCategoryTabs" class="sub-category-tabs hidden"></span>
          <button type="button" class="tab" data-tab="owned">보유/완료</button>
          <button type="button" class="tab" data-tab="unowned">미보유</button>
        </section>
      </section>

      <p id="resultCount">0개</p>
      <section id="list" class="grid"></section>
      <div id="loadMoreWrap" class="load-more-wrap hidden">
        <button id="loadMoreBtn" type="button">더보기</button>
      </div>
      <button
        id="catalogToggleAllFab"
        class="catalog-toggle-fab"
        type="button"
        onclick="return window.__acnhToggleAllOwnedInline(event);"
      >
        전체
      </button>
    </main>

    <section id="detailModal" class="modal hidden" aria-hidden="true">
      <div id="detailBackdrop" class="modal-backdrop"></div>
      <article class="modal-panel">
        <header class="modal-header">
          <div class="modal-title-wrap">
            <h2 id="detailTitle">상세 정보</h2>
            <span id="detailNavHint" class="detail-nav-hint"></span>
          </div>
          <div class="detail-nav-actions">
            <button id="detailPrevBtn" type="button">이전</button>
            <button id="detailNextBtn" type="button">다음</button>
            <button id="detailCloseBtn" type="button" class="modal-close">닫기</button>
          </div>
        </header>
        <div class="modal-body">
          <img id="detailImage" class="detail-image" alt="상세 이미지" />
          <p id="detailSourceHint" class="detail-source"></p>
          <section>
            <h3>기본 정보</h3>
            <div id="detailFields" class="detail-fields"></div>
          </section>
          <section id="detailExtraImagesSection" class="hidden">
            <h3>하우스 이미지</h3>
            <div id="detailExtraImages" class="variation-grid"></div>
          </section>
          <section>
            <h3>변형(색상/패턴)</h3>
            <div class="variation-actions">
              <button id="variationMarkAllBtn" type="button">전체 보유</button>
              <button id="variationUnmarkAllBtn" type="button">전체 해제</button>
            </div>
            <div id="detailVariations" class="variation-grid"></div>
          </section>
          <details class="raw-details">
            <summary>원문(raw) 필드 보기</summary>
            <div id="detailRawFields" class="raw-fields"></div>
          </details>
        </div>
      </article>
    </section>

    <section id="artGuideModal" class="modal hidden" aria-hidden="true">
      <div id="artGuideBackdrop" class="modal-backdrop"></div>
      <article class="modal-panel">
        <header class="modal-header">
          <h2>미술품 진품/가품 특징</h2>
          <button id="artGuideCloseBtn" type="button" class="modal-close">닫기</button>
        </header>
        <div class="modal-body">
          <p id="artGuideStatus" class="detail-source">로딩 중...</p>
          <section id="artGuideList" class="art-guide-list"></section>
        </div>
      </article>
    </section>
    <button id="scrollTopBtn" class="scroll-top-btn hidden" type="button" aria-label="맨 위로">
      ↑
    </button>

    <template id="villagerCardTemplate">
      <article class="card">
        <img class="icon" alt="주민 아이콘" />
        <div class="content">
          <h2 class="name-ko"></h2>
          <p class="name-en"></p>
          <p class="meta"></p>
          <p class="birthday"></p>
          <div class="toggles">
            <label><input type="checkbox" class="liked" /> 좋아하는 주민</label>
            <label><input type="checkbox" class="on-island" /> 우리 섬 주민</label>
            <label><input type="checkbox" class="former-resident" /> 과거 주민</label>
          </div>
        </div>
      </article>
    </template>

    <template id="catalogCardTemplate">
      <article class="card">
        <img class="icon" alt="카탈로그 아이콘" />
        <div class="content">
          <h2 class="name-ko"></h2>
          <p class="name-en"></p>
          <p class="meta"></p>
          <p class="description"></p>
          <div class="toggles">
            <label><input type="checkbox" class="owned" /> <span class="owned-label">보유</span></label>
            <label class="donated-wrap hidden"><input type="checkbox" class="donated" /> 박물관 기증</label>
            <label class="owned-qty-wrap hidden">
              개수
              <input type="number" class="owned-qty" min="0" step="1" inputmode="numeric" />
            </label>
          </div>
        </div>
      </article>
    </template>

    <nav id="mobileBottomNav" class="mobile-bottom-nav hidden" aria-label="모바일 하단 메뉴"></nav>
    <button
      id="mobileNavSheetBackdrop"
      class="mobile-nav-sheet-backdrop hidden"
      type="button"
      aria-label="하단 메뉴 닫기"
    ></button>
    <section id="mobileNavSheet" class="mobile-nav-sheet hidden" aria-hidden="true"></section>

    <script>
      (function () {
        var __acnhLastInlineToggleTs = 0;

        function getCatalogMode() {
          var list = document.querySelector("#list");
          if (list && list.dataset && list.dataset.catalogMode) return String(list.dataset.catalogMode).trim();
          if (document.body && document.body.dataset && document.body.dataset.activeMode) {
            return String(document.body.dataset.activeMode).trim();
          }
          return "";
        }

        function getOwnedInputs() {
          return Array.prototype.slice.call(document.querySelectorAll("#list .owned"));
        }

        function getItemIds(inputs) {
          var ids = inputs
            .map(function (el) {
              if (el && el.dataset && el.dataset.itemId) return String(el.dataset.itemId).trim();
              var card = el && el.closest ? el.closest(".card") : null;
              if (card && card.dataset && card.dataset.itemId) return String(card.dataset.itemId).trim();
              return "";
            })
            .filter(Boolean);
          if (ids.length) return ids;
          var cards = Array.prototype.slice.call(document.querySelectorAll("#list .card"));
          return cards
            .map(function (card) {
              return card && card.dataset && card.dataset.itemId ? String(card.dataset.itemId).trim() : "";
            })
            .filter(Boolean);
        }

        window.__acnhToggleAllOwnedInline = function (ev) {
          try {
            var now = Date.now();
            if (now - __acnhLastInlineToggleTs < 350) return false;
            __acnhLastInlineToggleTs = now;

            if (typeof window.__acnhForceBulkToggleVisible === "function") {
              window.__acnhForceBulkToggleVisible().catch(function (err) {
                console.error(err);
              });
              if (ev) {
                ev.preventDefault();
                ev.stopPropagation();
              }
              return false;
            }

            if (typeof window.__acnhHandleToggleAll === "function") {
              window.__acnhHandleToggleAll(ev);
            } else if (typeof window.__acnhToggleAllOwned === "function") {
              window.__acnhToggleAllOwned();
            } else {
              var inputs = getOwnedInputs();
              if (!inputs.length) return false;

              var allOwned = inputs.every(function (el) {
                return Boolean(el.checked) && !Boolean(el.indeterminate);
              });
              var nextOwned = !allOwned;
              inputs.forEach(function (el) {
                el.indeterminate = false;
                el.checked = nextOwned;
              });

              var mode = getCatalogMode();
              var ids = getItemIds(inputs);
              if (mode && ids.length) {
                fetch("/api/catalog/" + encodeURIComponent(mode) + "/state/bulk", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ item_ids: ids, owned: nextOwned }),
                }).catch(function (err) {
                  console.error(err);
                });
              }
            }
          } catch (err) {
            console.error(err);
          }
          if (ev) {
            ev.preventDefault();
            ev.stopPropagation();
          }
          return false;
        };
      })();
    </script>
    <script type="module" src="/static/app.js?v=20260219perf6"></script>
  </body>
</html>
