# ACNH 앱 확장/로그인 로드맵 (데이터 추가 이후)

- 문서 목적: 현재 단일 사용자 중심 프로토타입을, 다수 사용자가 로그인해 사용하는 서비스로 안전하게 확장하기 위한 실행 계획
- 적용 시점: **카탈로그 데이터(도감/아이템) 1차 확장 완료 후**
- 현재 기준일: 2026-02-15

## 0. 시작 조건 (Go/No-Go)

아래 조건이 충족되면 본 로드맵 착수:

1. 핵심 데이터 카테고리(주민, 미술품 포함)가 UX 기준으로 1차 안정화됨
2. 주요 회귀 버그(이미지, 상세 이동, 보유 체크)가 치명도 High 기준 0건
3. 배포 대상 환경(예: Render/Fly.io/AWS) 1개 이상 확정

## 1. 단계 요약

1. **Phase A (현행 안정화):** 현재 구조 정리/계측/기준선 확보
2. **Phase B (데이터 계층 강화):** 외부 API 의존도 축소, 로컬 저장/동기화 체계 도입
3. **Phase C (인증/멀티유저):** 로그인, 사용자 분리, 권한/보안 반영
4. **Phase D (URL 라우팅/UX):** 공유 가능한 URL, 뒤로가기/새로고침 복원
5. **Phase E (배포/운영):** CI/CD, 모니터링, 백업/복구, 운영 문서화

---

## Phase A. 현행 안정화 (1주)

목표:
- “확장 전 기준선”을 만든다.

작업:
1. 프론트/백엔드 성능 계측 포인트 추가
2. API 응답시간 p50/p95 측정 스크립트 추가
3. 핵심 사용자 흐름 smoke test 문서 보강
4. 정적 캐시 버전 정책 통일 (`index.html` 버전 키 관리 규칙)

완료 조건:
1. 느린 API/화면 Top 5 목록이 문서화됨
2. 회귀 테스트 체크리스트로 릴리즈 전 검증 가능

산출물:
- `docs/performance-baseline.md`
- `docs/release-checklist.md`

---

## Phase B. 데이터 계층 강화 (1~2주)

목표:
- 외부 API 호출에 덜 민감한 구조로 전환

작업:
1. Nookipedia 동기화 작업(배치) 도입
2. 카탈로그 정규화 테이블 설계 (아이템/상세/변형)
3. “조회는 로컬 DB 우선, 외부 API는 동기화 시점에만” 원칙 적용
4. 동기화 실패 시 이전 스냅샷 유지(롤백 가능) 처리

완료 조건:
1. 첫 화면/첫 상세 응답에서 외부 API 직접 의존 없음
2. 동기화 실패해도 서비스 조회 기능 유지

산출물:
- `docs/data-sync-design.md`
- `scripts/sync_nookipedia.py` (또는 동등 모듈)

---

## Phase C. 인증/멀티유저 (2주)

목표:
- 여러 사용자가 안전하게 데이터 분리 사용

작업:
1. DB 전환: SQLite -> PostgreSQL
2. 사용자 모델 추가 (`users`)
3. 인증 구현 (세션 또는 JWT + refresh 정책)
4. 기존 상태 테이블에 `user_id` 스코프 적용
   - villager_state
   - catalog_state
   - catalog_variation_state
   - island_profile
   - players
   - calendar_entries
5. API 권한 검증 미들웨어 적용
6. 비밀번호 해시/보안 설정 적용

완료 조건:
1. 사용자 A/B 데이터 완전 분리 확인
2. 인증 없는 상태 변경 API 접근 차단
3. 로그인/로그아웃/세션만료 시나리오 통과

산출물:
- `docs/auth-model.md`
- `docs/db-migration-plan.md`

---

## Phase D. URL 라우팅/UX 정합성 (1주)

목표:
- URL 공유/북마크/뒤로가기 지원

작업:
1. SPA 라우팅 도입 (`/home`, `/villagers`, `/catalog/:type`)
2. 필터/정렬/탭 상태를 URL query/hash와 동기화
3. 새로고침 시 동일 화면 복원
4. 상세 모달 deep-link 정책 결정

완료 조건:
1. URL 복사/재접속 시 동일 컨텍스트 재현
2. 브라우저 뒤로가기/앞으로가기 정상 동작

산출물:
- `docs/routing-spec.md`

---

## Phase E. 배포/운영 (1주)

목표:
- 운영 가능한 서비스 상태 확보

작업:
1. 환경 분리 (dev/staging/prod)
2. CI: lint + 테스트 + 빌드 + 배포 파이프라인
3. 모니터링/알림 (에러율, 지연시간, 동기화 실패)
4. 백업/복구 정책 (DB snapshot)
5. 보안 점검 (비밀키, CORS, rate limit, 기본 헤더)

완료 조건:
1. 스테이징 릴리즈 자동화
2. 장애 대응 문서/백업 복구 리허설 완료

산출물:
- `docs/deployment-runbook.md`
- `docs/incident-playbook.md`

---

## 우선순위 결정 규칙

1. 사용자 데이터 손실/혼합 가능성 > 성능 > 편의 기능
2. 인증/권한 완료 전 다중 사용자 공개 배포 금지
3. 외부 API 실시간 의존이 높은 기능은 공개 배포 전 동기화 구조로 전환

## 위험요소와 대응

1. 위험: 기존 단일 사용자 데이터 마이그레이션 누락
- 대응: 마이그레이션 dry-run + 백업 후 전환

2. 위험: 동기화 실패로 데이터 공백 발생
- 대응: last-good-snapshot 유지, 동기화 원자적 교체

3. 위험: 인증 도입 후 기존 API 호환성 깨짐
- 대응: 버전 라우팅 또는 점진 전환 플래그

## 권장 실행 순서 (실행용)

1. Phase A 완료
2. 데이터 카테고리 추가 작업 마무리
3. Phase B -> Phase C 순서로 진행
4. Phase D, E 병행

## 완료 정의 (프로젝트 레벨)

아래 모두 만족 시 “멀티유저 배포 준비 완료”:

1. PostgreSQL 기반 사용자 분리 데이터 저장
2. 인증/권한 미통과 요청 차단
3. URL 라우팅/상태 복원 지원
4. 배포 파이프라인 + 모니터링 + 백업 체계 운영
